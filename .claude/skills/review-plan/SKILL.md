---
name: review-plan
description: docs/plans/配下の実装計画を多角的にレビューし、考慮漏れや改善点をdocs/reviews/に出力する。「計画をレビューして」「プランをレビュー」「計画の問題点を確認」で起動。
argument-hint: "[plan-file-name]"
---

# Plan Review - 多角的計画レビュー

`docs/plans/` 配下のプランモードで作成した実装計画を、複数の視点から体系的にレビューし、改善レポートを `docs/reviews/` に出力する。

## When to Use

- 実装計画を作成した後、実装前にレビューしたい
- 計画の考慮漏れやリスクを事前に特定したい
- 第三者視点でのフィードバックがほしい

## Instructions

### Step 1: 対象ファイルの特定

引数 `$ARGUMENTS` が指定されている場合:
- `docs/plans/` 内で一致するファイルを探す（拡張子 `.md` は省略可能）

引数がない場合:
- `docs/plans/` 内の `.md` ファイルを更新日時の降順で取得し、**最新のファイルを自動選択**する
- 選択したファイル名をユーザーに表示してからレビューを開始する

対象ファイルが見つからない場合はエラーメッセージを出して終了。

### Step 2: コンテキスト収集

レビュー精度を高めるため、計画書に記載されたファイルや関連コードを探索する:

1. **計画書を読む** - 全文を精読
2. **関連ファイルの確認** - 計画書内で言及されているソースファイルの実装を確認
3. **プロジェクトルールの確認** - `.claude/rules/` の関連ルールを確認し、計画が規約に沿っているか把握
4. **要件定義の確認** - `.claude/requirements/` に関連する要件定義があれば参照
5. **既存の類似実装** - 計画の対象領域に既存コードがあれば確認

### Step 3: 多角的レビュー実行

以下の **7つの視点** で計画を評価する。各視点で問題がなければ「問題なし」と明記する。

#### 1. 技術的妥当性
- 実装アプローチは適切か
- 技術選定に問題はないか
- パフォーマンスへの影響は考慮されているか
- 代替アプローチとの比較は十分か

#### 2. 網羅性・考慮漏れ
- エッジケースは考慮されているか
- エラーハンドリングは十分か
- 影響範囲に見落としはないか
- ロールバック手順は必要か

#### 3. セキュリティ
- 認証・認可の考慮は十分か
- 入力バリデーションは適切か
- 機密情報の取り扱いに問題はないか
- OWASP Top 10の観点で脆弱性リスクはないか

#### 4. UX・アクセシビリティ
- ユーザー体験に影響する変更はないか
- WCAG 2.1 AA準拠は維持されるか
- レスポンシブデザインへの影響はないか
- エラー状態・ローディング状態は考慮されているか

#### 5. 保守性・拡張性
- コードの保守性は確保されるか
- 将来の拡張に対して柔軟か
- 技術的負債を増やしていないか
- テスト容易性は確保されるか

#### 6. プロジェクト整合性
- CLAUDE.mdのルール・規約に準拠しているか
- 既存のアーキテクチャパターンと整合するか
- 命名規則、ファイル配置は適切か
- 使用ライブラリは既存のものと整合するか

#### 7. 実行可能性
- 手順は具体的で実行可能か
- 依存関係は正しく整理されているか
- 検証方法は明確か
- 前提条件に漏れはないか

### Step 4: レビューレポート出力

`docs/reviews/` ディレクトリに以下の形式でレポートを出力する。ディレクトリが存在しない場合は作成する。

**ファイル名**: `{元ファイル名}-review.md`
例: `e2e-testing-plan.md` → `e2e-testing-plan-review.md`

#### レポートフォーマット

```markdown
# {計画名} レビューレポート

> **レビュー日時**: YYYY-MM-DD
> **対象ファイル**: `docs/plans/{file}`
> **総合評価**: {A / B / C / D}

## サマリー

{2-3文で計画の概要と総合的な評価を記述}

## 評価詳細

### 1. 技術的妥当性 {OK / WARN / NG}

{評価コメント}

### 2. 網羅性・考慮漏れ {OK / WARN / NG}

{評価コメント}

### 3. セキュリティ {OK / WARN / NG}

{評価コメント}

### 4. UX・アクセシビリティ {OK / WARN / NG}

{評価コメント}

### 5. 保守性・拡張性 {OK / WARN / NG}

{評価コメント}

### 6. プロジェクト整合性 {OK / WARN / NG}

{評価コメント}

### 7. 実行可能性 {OK / WARN / NG}

{評価コメント}

## 改善提案

### 必須（実装前に対処すべき）

| # | 視点 | 指摘事項 | 推奨対応 |
|---|------|---------|---------|
| 1 | ... | ... | ... |

### 推奨（対応が望ましい）

| # | 視点 | 指摘事項 | 推奨対応 |
|---|------|---------|---------|
| 1 | ... | ... | ... |

### 検討（余裕があれば）

| # | 視点 | 指摘事項 | 推奨対応 |
|---|------|---------|---------|
| 1 | ... | ... | ... |

## 総合所見

{計画全体に対する所見。良い点も含めてバランスよく記述}
```

#### 総合評価の基準

| 評価 | 基準 |
|------|------|
| A | 必須指摘なし。そのまま実装可能 |
| B | 軽微な改善点あり。修正後に実装可能 |
| C | 重要な考慮漏れあり。計画修正が必要 |
| D | 根本的な問題あり。計画の見直しが必要 |

### Step 5: 結果の報告

レビューレポートのサマリーをユーザーに報告する:
- 総合評価
- 必須指摘の件数と概要
- 推奨・検討の件数
- レポートファイルのパス

## Notes

- レビューは計画の「品質ゲート」として機能する。実装に入る前に実施することを推奨
- 既存の `.claude/reviews/` にもレビューファイルがあるが、本スキルは `docs/reviews/` に出力する（プロジェクトドキュメントとして管理）
- 同名のレビューファイルが既に存在する場合は上書きする（最新のレビュー結果が常に参照できるように）

# TDD Development（テスト駆動開発）

このプロジェクトはTDD（テスト駆動開発）手法を採用している。

## 開発フロー

```
/requirements → [Plan] → /pencil-design → レビュー → /gen-test → /implement-tests → /refactor
    ↓             ↓            ↓              ↓           ↓              ↓               ↓
 要件定義      実装計画     UIデザイン        承認        Red           Green          Refactor
 (仕様策定)   (複雑な場合)  (Pencil)            (失敗テスト)   (最小実装)     (品質改善)
```

**Note**: `[Plan]`は複雑な機能（3ファイル以上、100行以上）の場合のみ。詳細は`plan-mode.md`を参照。

## UI開発フロー（Design First）

**UIを含む機能開発では、実装前にPencilでデザインを作成する。**

1. **要件定義** (`/requirements`) - ユーザーと対話しながら詳細仕様を策定
2. **UIデザイン** (`/pencil-design`) - Pencilでデザインを作成
3. **レビュー・承認** - ユーザーにデザインを確認してもらう
4. **TDD実装** (`/gen-test` → `/implement-tests` → `/refactor`)

## デザインの管理

**Pencil**でデザインを管理する。
プロジェクト名: `scenario-manager`

フレーム名は `セクション名 / 画面名` 形式で統一:
- `Components` - 共通コンポーネント定義
- `Scenarios / 検索画面` - /scenarios
- `Scenarios / 詳細画面` - /scenarios/[id]

## TDDスキル・エージェント一覧

| 名前 | 種別 | フェーズ | 説明 |
|------|------|---------|------|
| `/requirements` | スキル | 要件定義 | ユーザーと対話しながら詳細仕様を策定 |
| `Plan` | エージェント | 計画 | 複雑な機能の実装計画を設計（3ファイル以上、100行以上の変更） |
| `/pencil-design` | スキル | UIデザイン | 要件定義を元にPencilでUIデザインを作成 |
| `/stitch-design` | スキル | UIデザイン | 要件定義を元にGoogle Stitch MCPでデザインを生成 |
| `/component-spec` | スキル | 要件定義 | Pencilデザインを元にコンポーネント仕様を定義 |
| `/gen-test` | スキル | Red | 要件定義書から失敗するテストを生成 |
| `tdd-implementer` | エージェント | Green | テストを通過させる最小限の実装（自律実行） |
| `tdd-refactorer` | エージェント | Refactor | テストを維持しながらコード品質を改善（自律実行） |
| `/fix-bug` | スキル | バグ修正 | テストケース見直し → 再現テスト → 修正 |
| `/redesign` | スキル | UI更新 | Pencilデザインを唯一の情報源としてUIをリデザイン |
| `/exec-plan` | スキル | 実装 | 計画をTodoList化してサブエージェントで順次実装 |

**スキル vs エージェントの使い分け**:
- スキル: ユーザーとの対話が必要（確認・選択）
- エージェント: 自律実行可能（明確なゴールがある）

## 適用場面

| 場面 | Design First | 直接実装 |
|------|:------------:|:--------:|
| 新規画面の開発 | ○ | - |
| 複雑なコンポーネント | ○ | - |
| UIリニューアル | ○ | - |
| 軽微なスタイル修正 | ○ | - |
| ロジックのみの変更 | - | ○ |
| 既存パターンの再利用 | - | ○ |

## 進捗追跡

TDD進捗は `.claude/PROGRESS.md` の「TDD進捗」セクションで追跡する:

```markdown
| 対象 | 要件定義 | テスト設計 | テスト実装 | 機能実装 | リファクタ | 状態 |
|------|:-------:|:--------:|:--------:|:-------:|:---------:|------|
| searchFormSchema | ✅ | ✅ | ✅ | ✅ | ⬜ | 機能実装済 |
```

## バグ修正フロー

`/fix-bug` スキルを使用:

1. **テストケース見直し**: バグはテスト不足の証拠
2. **再現テスト作成（Red）**: バグを再現するテストを書く
3. **修正（Green）**: 最小限の修正でテストをパス
4. **リファクタ（任意）**: 必要に応じてコード改善

## リファクタリング時のルール

- 既存テストは必ず実行し、パスを維持
- 仕様変更がある場合はテストケースも更新
- 動作を変えずに品質のみを改善

## 要件定義書の配置

```
.claude/requirements/
├── requirements-v1.md          # プロジェクト全体の基本要件
├── requirements-feedback.md    # フィードバック機能
├── requirements-session-flow.md # セッションフロー
└── requirements-review-ui.md   # レビューUI
```

## スキル使い分けガイド

| 状況 | 使用するスキル | 理由 |
|------|---------------|------|
| 新機能の開発 | `/requirements` → `/gen-test` → `/implement-tests` → `/refactor` | TDDフローで品質を担保 |
| バグ修正 | `/fix-bug` | 再現テスト作成 → 修正でバグ再発を防止 |
| コーディング規約チェック | `/review-fix` | `coding-standards.md`準拠の確認・自動修正 |
| アドホックな問題解決 | `/serena` | TDDに乗らない調査・設計・実装 |
